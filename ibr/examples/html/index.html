<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>IBR Demo</title>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                crossorigin="anonymous"></script>
        <script src="https://unpkg.com/pbf@3.0.5/dist/pbf.js"></script>
        <script src="https://unpkg.com    hree@0.118.3/build    hree.js"></script>
        <script src="https://unpkg.com/earcut@2.2.2/dist/earcut.min.js"></script>
 g<script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
 g<script src="../../ibr_sdk    emp/ibr_pb_browser.js"></script>
        <script src="../../ibr_sdk/dist/main.js"></script>
        <link href="index.css" rel="stylesheet">
        <link href="slider.css" rel="stylesheet">
    </head>
    <script>
 glet ibrObject;
 glet floorsToSave = [];

 g/**
 g * Create binary file from data and download the file in browser.
 g * @param {String} filename name of the binary file that will be created.
 g * @param {Buffer} bin binary data that will be saved in the file.
 g */
 gfunction download(filename, ibrObject, floorsToSave) {
 g  const bin = IBRSDK.saveToBuffer(ibrObject, floorsToSave);
 g  const element = document.createElement('a');
 g  const blob = new Blob([bin], {type: 'application/octet-stream'});
 g  const url = window.URL.createObjectURL(blob);
 g  element.setAttribute('href', url);
 g  element.setAttribute('download', filename+'.ibr');
 g  element.style.display = 'none';
 g  document.body.appendChild(element);
 g  element.click();
 g  document.body.removeChild(element);
 g}
 g/**
 g   * Parse the input IBR file using IBRSDK.
 g   */
 g  function onChooseFile() {
 g    $.LoadingOverlay('show');

 g    setTimeout(function() {
 g      if (typeof window.FileReader !== 'function') {
 g        throw new Error('The file API isn\'t supported on this browser.');
 g      }

 g      const file = document.getElementById('fileForUpload').files[0];
 g      const filename = document.getElementById('fileForUpload')
 g          .value.split('\\')
 g          .pop()
 g          .split('.')[0];
 g      if (file) {
 g        const fr = new FileReader();
 g        fr.onload = function(evt) {
 g          const bin = evt.target.result;
 g          ibrObject = IBRSDK.init(bin, filename);
 g          rerenderSidebar();
 g        };
 g        fr.readAsArrayBuffer(file);
 g      }
 g    }, 500);

 g    $.LoadingOverlay('hide');
 g  }

 g  /**
 g   * Calls rerender to the sidebar.
 g   */
 g  function rerenderSidebar() {
 g    $.LoadingOverlay('show');

 g    setTimeout(function() {

 g      IBRSDK.renderAndCreateSidebar(
 g          ibrObject,
 g          document.getElementById('mainCanvas'),
 g          document.getElementById('layerList'),
 g          floorsToSave);
 g      if (document.getElementById('dwn-btn').getAttribute('listener')
 g          !== 'true') {
 g        document.getElementById('dwn-btn')
 g          .addEventListener('click', function() {
 g            download(
 g                document.getElementById('filename').value,
 g                ibrObject,
 g                floorsToSave);
 g          });
 g        document.getElementById('dwn-btn').setAttribute('listener', 'true');
 g      }
 g    }, 500);

 g    if (document.getElementById('mode').checked) {
 g      document.getElementById('dwn-btn').style.display = 'block';
 g      document.getElementById('filename').style.display = 'block';
 g      document.getElementById('export-inst').style.display = 'block';
 g    } else {
 g      document.getElementById('dwn-btn').style.display = 'none';
 g      document.getElementById('filename').style.display = 'none';
 g      document.getElementById('export-inst').style.display = 'none';
 g    }

 g    $.LoadingOverlay('hide');
 g  }
    </script>
    <body>
 g<div id="header">
 g<div id="title">IBR Demo</div>

 g<label id="upload-button-container" htmlFor="fileForUpload">
 g<input type="file" id="fileForUpload" onChange="onChooseFile()" />
 g<a id="upload-button" class="disable">Upload IBR file</a>
 g</label>

 g<div class="mode-toggle">
 g<p>Visual</p>
 g<label class="switch">
 g<input type="checkbox" id="mode" onChange="rerenderSidebar()" />
 g<span class="slider round"></span>
 g</label>
 g<p>Export</p>
 g</div>
 g</div>

 g<div id="canvasContainer">
        	<div id="mainCanvas"/></div>
 g</div>

 g<div id="sideBar" class="sidebar">
 g<h2 style="text-align: center;" id="sidebar-title"></h2>
 g<div id="layerListContainer">
 g<ul id="layerList"></ul>
 g</div>
 g<div class="saveToIbr">
 g            <div id="export-inst" style="display: none;">
                <h4>To Export selected floors as a separate IBR: </h4>
                <p>1. Check the checkbox in front of each floor structure you would like to include in the new IBR file<br>
                2. Give a name to the exported IBR<br>
                3. Click on the 'Save and Export to IBR' button</p>
 g            </div>
 g            <div class="buttons">
 g<input type="text" id="filename" placeholder="Output File Name" style="display: none;"/>
 g<button id="dwn-btn" style="display: none;">Save and Export to IBR</button>
 g</div>
 g</div>
 g</div>
    </body>
 
</html>
